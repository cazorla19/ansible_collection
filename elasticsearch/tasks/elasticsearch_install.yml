- name: get gpg key [CentOS/RHEL]
  rpm_key: state=present key=http://packages.elastic.co/GPG-KEY-elasticsearch
  when: ansible_distribution == "CentOS" or ansible_distribution == "Red Hat Enterprise Linux"
  tags: repo

- name: get gpg key [Debian/Ubuntu]
  apt_key: url=https://packages.elastic.co/GPG-KEY-elasticsearch state=present
  when: ansible_distribution == "Debian" or ansible_distribution == "Ubuntu"
  tags: repo

- name: get elasticsearch repo [CentOS/RHEL]
  copy: src=elasticsearch.repo dest=/etc/yum.repos.d/elasticsearch.repo force=yes
  when: ansible_distribution == "CentOS" or ansible_distribution == "Red Hat Enterprise Linux"
  tags: repo

- name: get elasticsearch repo [Debian/Ubuntu]
  apt_repository: repo='deb http://packages.elastic.co/elasticsearch/{{ elasticsearch_version }}/debian stable main' state=present
  when: ansible_distribution == "Debian" or ansible_distribution == "Ubuntu"
  tags: repo

- name: update repo [Debian/Ubuntu]
  apt: update_cache=yes
  tags: update
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: install elasticsearch
  package: name=elasticsearch state=present allow_unauthenticated=yes
  tags: install

- name: configure elasticsearch
  lineinfile: "dest=/etc/elasticsearch/elasticsearch.yml regexp='^# network.host' line='network.host: localhost'"
  notify: restart elasticsearch
  tags: configure

- name: enable and start elasticsearch
  service: name=elasticsearch enabled=yes state=started
  tags: configure
